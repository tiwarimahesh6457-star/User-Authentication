<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
</head>
<body>
    <h1 id="title"></h1>

    <div id="admin-section"
    style="display:none"><h3>
        All-Users
    </h3>
    <ul id="users"></ul>
    <p id="msg"></p>
</div>
    <button onclick="logout()">Logout</button>
    <script>
        const API = "http://localhost:4000/api";
        
        (async function initDashboard() {
        
          // Try admin for First then user
          let res = await fetch(`${API}/admin/dashboard`, {
            credentials: "include",
          });
        
          if (res.ok) {
            const users = await res.json();
            document.getElementById("title").innerText = "Admin Dashboard";
            document.getElementById("admin-section").style.display = "block";
        
            const ul = document.getElementById("users");
            users.forEach((u) => {
              const li = document.createElement("li");
              li.innerText = `${u.name} (${u.email}) - ${u.role}`;
              ul.appendChild(li);
            });
            return;
          }
        
          res = await fetch(`${API}/users/dashboard`, {
            credentials: "include"
          });
        
          if (res.ok) {
            document.getElementById("title").innerText = "User Dashboard";
            msg.innerText="Welcome User!"
            return;
          }
        
          window.location.href = "login.html";
        })();
        
        async function logout() {
          await fetch(`${API}/auth/logout`, {
            method: "POST",
            credentials: "include"
          });
          msg.innerText = "Logout successfully"
          setTimeout(() => {
            window.location.href = "login.html";
          }, 1500); 
         
         
        }
        </script>
        
</body>
</html>
